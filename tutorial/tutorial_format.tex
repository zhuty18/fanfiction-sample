
\def\freefont{} % 使用免费商业字体
\newcommand{\mytitleen}{Typesetting Tutorial for \LaTeX}
\newcommand{\mytitle}{\LaTeX 排版教程}
\newcommand{\myauthor}{兔子草}
\newcommand{\myquote}{\hfill ——排版，只需要一个浏览器\hspace{15mm}}
\def\version{1.0}

\input{./font.tex}
% \input{../formats.tex}

\usepackage{setspace}

% 这部分设定纯为教程服务 
\usepackage{xcolor}
\definecolor{gray}{RGB}{68,71,90}
\definecolor{grayblue}{RGB}{98,144,164}
\definecolor{cyan}{RGB}{139, 233, 253}
\definecolor{green}{RGB}{80, 250, 123}
\definecolor{orange}{RGB}{255, 184, 108}
\definecolor{pink}{RGB}{255, 121, 198}
\definecolor{purple}{RGB}{189, 147, 249}
\definecolor{red}{RGB}{255, 85, 85}
\definecolor{yellow}{RGB}{241, 250, 140}
\definecolor{myblack}{RGB}{32, 34, 39}
\definecolor{darkgreen}{RGB}{31,138,35}
\usepackage{hyperref}
\hypersetup{colorlinks,linkcolor=black,urlcolor=darkgreen}
\usepackage{metalogo}
\usepackage{enumitem}
\usepackage[normalem]{ulem}
\usepackage{listings}
\renewcommand{\lstlistingname}{代码}
\renewcommand{\lstlistlistingname}{代码}
\lstset{
    flexiblecolumns,
    numbers=left,
    numberstyle=\footnotesize\color{gray},
    frame=leftline,
    showspaces=false,
    linewidth=\linewidth,
    xleftmargin=2\ccwd,
    breaklines=true,
    columns=fixed,
    basicstyle=\small\ttfamily,
    captionpos=b,
}
\lstdefinestyle{TeX}{
    language=TeX,
    morekeywords={usepackage,begin,newcommand,renewcommand,counterwithout,setcounter,addcounter,part,chapter,section,clearpage,newpage,cleardoublepage,thepage,setlength,addtolength,newlength,ctexset,plus,minus,makeatletter,makeatother,patchcmd,@addtoreset,addcontentsline},
    emph={documentclass,document,setmainfont,newfontfamily,BoldFont,ItalicFont,setCJKmainfont,newCJKfontfamily,geometry,newgeometry,restoregeometry,titleformat,titlespacing,blankpage,singlespacing,onehalfspacing,doublespacing,setstretch,pagestyle,thispagestyle,punctstyle,roman,titlecontents,vspace,hspace,makebox,mbox,@pnumwidth,startcontents,stopcontents,printcontents,hypersetup,fancypagestyle,fancyhf,fancyhead,fancyfoot,markboth,markright,fancyhfoffset,fancyheadoffset,fancyfootoffset,includegraphics,figure,caption,captionsetup,includepdf,subfile},
    basicstyle=\small\ttfamily\color{myblack},
    identifierstyle=\color{purple},
    keywordstyle=\color{pink},
    emphstyle=\color{orange},
    stringstyle=\color{yellow},
    commentstyle=\color{grayblue},
}
\usepackage{makecell}
\newcommand{\emoji}[1]{{\fontspec{Symbola}\symbol{#1}}}
\newcommand{\checkmark}{
    \makebox[1\ccwd]{
        \fboxsep1.5pt
        \colorbox{green}{\emoji{"2714}}
    }
}
\usepackage{longtable}
\newenvironment{tightitem}
{\begin{itemize}[topsep=0pt,partopsep=0pt,itemsep=0pt,parsep=0pt,leftmargin=3\ccwd,labelwidth=1.5\ccwd,labelsep=.5\ccwd]}
        {\end{itemize}}

\newenvironment{tightenum}
{\begin{enumerate}[topsep=0pt,partopsep=0pt,itemsep=0pt,parsep=0pt,leftmargin=3\ccwd,labelwidth=1.5\ccwd,labelsep=.5\ccwd]}
        {\end{enumerate}}

\newcommand{\testtext}{

    Hal低低地笑了：“我希望你把蝙蝠车留给Tim，然后回家。……他说愿意替你7个小时的班，让你休息一下。”}
\usepackage{float}
\usepackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}
\renewcommand{\sectionmark}[1]{\markright{#1}}
% 去除页眉横线
\renewcommand{\headrulewidth}{0pt}
% 页脚溢出一点
\fancyfootoffset[RO,LE]{1.5em}
\fancypagestyle{mystyle}{
    \fancyhf{}
    \fancyhead[CE]{\headfont\mytitle}
    \fancyhead[CO]{\headfont\uppercase\expandafter{\romannumeral\thechapter}\quad\leftmark}
    \fancyfoot[CO]{\hfill\headfont BY \myauthor\qquad\rule[-4pt]{0.3pt}{20pt}\hspace{1.5em}}
    \fancyfoot[RO]{\pagenumberfont\thepage}
    \fancyfoot[LE]{\pagenumberfont\thepage}
    \fancyfoot[CE]{\hspace{1.5em}\rule[-4pt]{0.3pt}{20pt}\qquad\headfont\uppercase\expandafter{\romannumeral\thechapter}\hfill}
}
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[CO]{\hfill\headfont BY \myauthor\qquad\rule[-4pt]{0.3pt}{20pt}\hspace{1.5em}}
    \fancyfoot[RO]{\pagenumberfont\thepage}
    \fancyfoot[LE]{\pagenumberfont\thepage}
    \fancyfoot[CE]{\hspace{1.5em}\rule[-4pt]{0.3pt}{20pt}\qquad\headfont\uppercase\expandafter{\romannumeral\thechapter}\hfill}
}

\newlength{\ptop}
\newlength{\pbottom}
\newlength{\pinner}
\newlength{\pouter}
\newlength{\phsep}
\newlength{\pfskip}

\setlength{\ptop}{21mm}
\setlength{\pbottom}{21mm}
\setlength{\pinner}{14mm}
\setlength{\pouter}{13.5mm}
\setlength{\phsep}{.8\baselineskip}
\setlength{\pfskip}{2.2\baselineskip}
\addtolength{\pfskip}{-1em}

\newcommand{\charcount}{40}
\newcommand{\linecount}{41}

\newlength{\theight}
\setlength{\theight}{\linecount\baselineskip}
\addtolength{\theight}{1em}
\addtolength{\theight}{-\baselineskip}

\usepackage{geometry}
\geometry{
    paperwidth=6.625in,
    paperheight=10.25in,
    top=\ptop,
    inner=\pinner,
    % outer=\pouter,
    % bottom=\pbottom,
    textwidth=\charcount\ccwd,
    textheight=\theight,
    headsep=\phsep,
    footskip=\pfskip,
}

\counterwithout{section}{chapter}
\counterwithout{subsection}{section}
\makeatletter
\@addtoreset{section}{chapter}
\@addtoreset{subsection}{section}
\makeatother

\usepackage{titletoc}
\usepackage{titlesec}
\renewcommand{\contentsname}{目\quad 录}

\titlecontents{chapter}
[4mm]
{\vspace{0.3em}\large\tocchapter}
{\makebox[10mm][l]{\normalsize\uppercase\expandafter{\romannumeral\thecontentslabel}}}
{}
{\hfill\tocpage\large\contentspage}[\vspace{0.3em}]

\renewcommand{\tocsectlabel}{\fontspec{EB Garamond SmallCaps 12 Regular}[Numbers=Lining]}
\renewcommand{\sectionfont}{\tocsectlabel\sbsong}
\renewcommand{\subsectionfont}{\tocsubsection\songti}
\renewcommand{\tocsubsectlabel}{\subsectionfont}
\titlecontents{section}
[8mm]
{\tocsection}
{\tocsectlabel \S \hspace{0.1em}\makebox[1.2em][c]{\thecontentslabel}\hspace{1em}\sectionfont}{}
{\dotfill\tocpage\contentspage}

\titlecontents{subsection}
[16mm]
{\tocsubsection}
{\small\tocsubsectlabel\hspace{0.2em}\makebox[1em][c]{\expandafter{\romannumeral\thecontentslabel}}\hspace{0.8em}}{}
{\dotfill\small\tocpage\contentspage}{}

\titleformat{\chapter}{\centering\Large\chapterfont}{\uppercase\expandafter{\romannumeral\thechapter}}{1em}{}
\titlespacing{\chapter}{0em}{.5\baselineskip}{2\baselineskip}
\titleformat{\section}{\sectionfont}{\S~\thesection}{1em}{}
\titlespacing{\section}{2em}{1.4\baselineskip plus 2pt minus 2pt}{.5\baselineskip plus 2pt minus 2pt}
\titleformat{\subsection}{\subsectionfont}{\expandafter{\romannumeral\thesubsection}}{1em}{}
\titlespacing{\subsection}{2em}{.5\baselineskip plus 2pt minus 2pt}{.5\baselineskip plus 2pt minus 2pt}

\newcommand{\jumpto}[2]{\href{#1}{#2\footnote{#1}}}

\newcommand{\signature}{
    \vspace{2\baselineskip}
    \hfill\begin{minipage}[b]{6em}
        \begin{center}
            \includegraphics[width=2.8em]{../headshot.png}\hspace{5.1em}
            \subsectionfont
            by\myauthor

            \emoji{"1F427} 3440950898
        \end{center}
    \end{minipage}\hspace{4em}

    \vspace{2\baselineskip}
}

\newfontfamily\bcfont{BlackChancery}
\renewcommand{\titlefont}{\bcfont\bsong}
\newcommand{\mytitlepage}{
    \null
    \vspace{.18\textheight}
    \thispagestyle{empty}

    \begin{center}
        \Huge

        \titlefont

        {\mytitleen}

        \vspace{2mm}

        {\mytitle}

        \vspace{2mm}

        {\large\fangsong\myquote}

        \vspace{.32\textheight}

        \Large

        {\signfont BY \myauthor}

        {\large\signfont v\version}
    \end{center}

    \clearpage
}

\usepackage{changepage}

\newcommand{\blankpar}{
    ~\
}

\usepackage{indentfirst}

\usepackage{footnpag}

\usepackage{emptypage}

\usepackage{multicol}

% \usepackage{mathfont}

% \mathfont[greeklower]{EB Garamond 12 Italic}

\newcommand{\myendpage}{
    \clearpage
    \ifodd\thepage
    \else
        \mbox{}
        \thispagestyle{empty}
        \clearpage
    \fi
}
